{"version":3,"sources":["jquery.flot.canvas.js"],"names":[],"mappings":"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","file":"jquery.flot.canvas-compiled.js","sourcesContent":["/* Flot plugin for drawing all elements of a plot on the canvas.\n\nCopyright (c) 2007-2013 IOLA and Ole Laursen.\nLicensed under the MIT license.\n\nFlot normally produces certain elements, like axis labels and the legend, using\nHTML elements. This permits greater interactivity and customization, and often\nlooks better, due to cross-browser canvas text inconsistencies and limitations.\n\nIt can also be desirable to render the plot entirely in canvas, particularly\nif the goal is to save it as an image, or if Flot is being used in a context\nwhere the HTML DOM does not exist, as is the case within Node.js. This plugin\nswitches out Flot's standard drawing operations for canvas-only replacements.\n\nCurrently the plugin supports only axis labels, but it will eventually allow\nevery element of the plot to be rendered directly to canvas.\n\nThe plugin supports these options:\n\n{\n    canvas: boolean\n}\n\nThe \"canvas\" option controls whether full canvas drawing is enabled, making it\npossible to toggle on and off. This is useful when a plot uses HTML text in the\nbrowser, but needs to redraw with canvas text when exporting as an image.\n\n*/\n\n(function($) {\n\n\tvar options = {\n\t\tcanvas: true\n\t};\n\n\tvar render, getTextInfo, addText;\n\n\t// Cache the prototype hasOwnProperty for faster access\n\n\tvar hasOwnProperty = Object.prototype.hasOwnProperty;\n\n\tfunction init(plot, classes) {\n\n\t\tvar Canvas = classes.Canvas;\n\n\t\t// We only want to replace the functions once; the second time around\n\t\t// we would just get our new function back.  This whole replacing of\n\t\t// prototype functions is a disaster, and needs to be changed ASAP.\n\n\t\tif (render == null) {\n\t\t\tgetTextInfo = Canvas.prototype.getTextInfo,\n\t\t\taddText = Canvas.prototype.addText,\n\t\t\trender = Canvas.prototype.render;\n\t\t}\n\n\t\t// Finishes rendering the canvas, including overlaid text\n\n\t\tCanvas.prototype.render = function() {\n\n\t\t\tif (!plot.getOptions().canvas) {\n\t\t\t\treturn render.call(this);\n\t\t\t}\n\n\t\t\tvar context = this.context,\n\t\t\t\tcache = this._textCache;\n\n\t\t\t// For each text layer, render elements marked as active\n\n\t\t\tcontext.save();\n\t\t\tcontext.textBaseline = \"middle\";\n\n\t\t\tfor (var layerKey in cache) {\n\t\t\t\tif (hasOwnProperty.call(cache, layerKey)) {\n\t\t\t\t\tvar layerCache = cache[layerKey];\n\t\t\t\t\tfor (var styleKey in layerCache) {\n\t\t\t\t\t\tif (hasOwnProperty.call(layerCache, styleKey)) {\n\t\t\t\t\t\t\tvar styleCache = layerCache[styleKey],\n\t\t\t\t\t\t\t\tupdateStyles = true;\n\t\t\t\t\t\t\tfor (var key in styleCache) {\n\t\t\t\t\t\t\t\tif (hasOwnProperty.call(styleCache, key)) {\n\n\t\t\t\t\t\t\t\t\tvar info = styleCache[key],\n\t\t\t\t\t\t\t\t\t\tpositions = info.positions,\n\t\t\t\t\t\t\t\t\t\tlines = info.lines;\n\n\t\t\t\t\t\t\t\t\t// Since every element at this level of the cache have the\n\t\t\t\t\t\t\t\t\t// same font and fill styles, we can just change them once\n\t\t\t\t\t\t\t\t\t// using the values from the first element.\n\n\t\t\t\t\t\t\t\t\tif (updateStyles) {\n\t\t\t\t\t\t\t\t\t\tcontext.fillStyle = info.font.color;\n\t\t\t\t\t\t\t\t\t\tcontext.font = info.font.definition;\n\t\t\t\t\t\t\t\t\t\tupdateStyles = false;\n\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\tfor (var i = 0, position; position = positions[i]; i++) {\n\t\t\t\t\t\t\t\t\t\tif (position.active) {\n\t\t\t\t\t\t\t\t\t\t\tfor (var j = 0, line; line = position.lines[j]; j++) {\n\t\t\t\t\t\t\t\t\t\t\t\tcontext.fillText(lines[j].text, line[0], line[1]);\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\t\tpositions.splice(i--, 1);\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\tif (positions.length == 0) {\n\t\t\t\t\t\t\t\t\t\tdelete styleCache[key];\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tcontext.restore();\n\t\t};\n\n\t\t// Creates (if necessary) and returns a text info object.\n\t\t//\n\t\t// When the canvas option is set, the object looks like this:\n\t\t//\n\t\t// {\n\t\t//     width: Width of the text's bounding box.\n\t\t//     height: Height of the text's bounding box.\n\t\t//     positions: Array of positions at which this text is drawn.\n\t\t//     lines: [{\n\t\t//         height: Height of this line.\n\t\t//         widths: Width of this line.\n\t\t//         text: Text on this line.\n\t\t//     }],\n\t\t//     font: {\n\t\t//         definition: Canvas font property string.\n\t\t//         color: Color of the text.\n\t\t//     },\n\t\t// }\n\t\t//\n\t\t// The positions array contains objects that look like this:\n\t\t//\n\t\t// {\n\t\t//     active: Flag indicating whether the text should be visible.\n\t\t//     lines: Array of [x, y] coordinates at which to draw the line.\n\t\t//     x: X coordinate at which to draw the text.\n\t\t//     y: Y coordinate at which to draw the text.\n\t\t// }\n\n\t\tCanvas.prototype.getTextInfo = function(layer, text, font, angle, width) {\n\n\t\t\tif (!plot.getOptions().canvas) {\n\t\t\t\treturn getTextInfo.call(this, layer, text, font, angle, width);\n\t\t\t}\n\n\t\t\tvar textStyle, layerCache, styleCache, info;\n\n\t\t\t// Cast the value to a string, in case we were given a number\n\n\t\t\ttext = \"\" + text;\n\n\t\t\t// If the font is a font-spec object, generate a CSS definition\n\n\t\t\tif (typeof font === \"object\") {\n\t\t\t\ttextStyle = font.style + \" \" + font.variant + \" \" + font.weight + \" \" + font.size + \"px \" + font.family;\n\t\t\t} else {\n\t\t\t\ttextStyle = font;\n\t\t\t}\n\n\t\t\t// Retrieve (or create) the cache for the text's layer and styles\n\n\t\t\tlayerCache = this._textCache[layer];\n\n\t\t\tif (layerCache == null) {\n\t\t\t\tlayerCache = this._textCache[layer] = {};\n\t\t\t}\n\n\t\t\tstyleCache = layerCache[textStyle];\n\n\t\t\tif (styleCache == null) {\n\t\t\t\tstyleCache = layerCache[textStyle] = {};\n\t\t\t}\n\n\t\t\tinfo = styleCache[text];\n\n\t\t\tif (info == null) {\n\n\t\t\t\tvar context = this.context;\n\n\t\t\t\t// If the font was provided as CSS, create a div with those\n\t\t\t\t// classes and examine it to generate a canvas font spec.\n\n\t\t\t\tif (typeof font !== \"object\") {\n\n\t\t\t\t\tvar element = $(\"<div>&nbsp;</div>\")\n\t\t\t\t\t\t.css(\"position\", \"absolute\")\n\t\t\t\t\t\t.addClass(typeof font === \"string\" ? font : null)\n\t\t\t\t\t\t.appendTo(this.getTextLayer(layer));\n\n\t\t\t\t\tfont = {\n\t\t\t\t\t\tlineHeight: element.height(),\n\t\t\t\t\t\tstyle: element.css(\"font-style\"),\n\t\t\t\t\t\tvariant: element.css(\"font-variant\"),\n\t\t\t\t\t\tweight: element.css(\"font-weight\"),\n\t\t\t\t\t\tfamily: element.css(\"font-family\"),\n\t\t\t\t\t\tcolor: element.css(\"color\")\n\t\t\t\t\t};\n\n\t\t\t\t\t// Setting line-height to 1, without units, sets it equal\n\t\t\t\t\t// to the font-size, even if the font-size is abstract,\n\t\t\t\t\t// like 'smaller'.  This enables us to read the real size\n\t\t\t\t\t// via the element's height, working around browsers that\n\t\t\t\t\t// return the literal 'smaller' value.\n\n\t\t\t\t\tfont.size = element.css(\"line-height\", 1).height();\n\n\t\t\t\t\telement.remove();\n\t\t\t\t}\n\n\t\t\t\ttextStyle = font.style + \" \" + font.variant + \" \" + font.weight + \" \" + font.size + \"px \" + font.family;\n\n\t\t\t\t// Create a new info object, initializing the dimensions to\n\t\t\t\t// zero so we can count them up line-by-line.\n\n\t\t\t\tinfo = styleCache[text] = {\n\t\t\t\t\twidth: 0,\n\t\t\t\t\theight: 0,\n\t\t\t\t\tpositions: [],\n\t\t\t\t\tlines: [],\n\t\t\t\t\tfont: {\n\t\t\t\t\t\tdefinition: textStyle,\n\t\t\t\t\t\tcolor: font.color\n\t\t\t\t\t}\n\t\t\t\t};\n\n\t\t\t\tcontext.save();\n\t\t\t\tcontext.font = textStyle;\n\n\t\t\t\t// Canvas can't handle multi-line strings; break on various\n\t\t\t\t// newlines, including HTML brs, to build a list of lines.\n\t\t\t\t// Note that we could split directly on regexps, but IE < 9 is\n\t\t\t\t// broken; revisit when we drop IE 7/8 support.\n\n\t\t\t\tvar lines = (text + \"\").replace(/<br ?\\/?>|\\r\\n|\\r/g, \"\\n\").split(\"\\n\");\n\n\t\t\t\tfor (var i = 0; i < lines.length; ++i) {\n\n\t\t\t\t\tvar lineText = lines[i],\n\t\t\t\t\t\tmeasured = context.measureText(lineText);\n\n\t\t\t\t\tinfo.width = Math.max(measured.width, info.width);\n\t\t\t\t\tinfo.height += font.lineHeight;\n\n\t\t\t\t\tinfo.lines.push({\n\t\t\t\t\t\ttext: lineText,\n\t\t\t\t\t\twidth: measured.width,\n\t\t\t\t\t\theight: font.lineHeight\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\tcontext.restore();\n\t\t\t}\n\n\t\t\treturn info;\n\t\t};\n\n\t\t// Adds a text string to the canvas text overlay.\n\n\t\tCanvas.prototype.addText = function(layer, x, y, text, font, angle, width, halign, valign) {\n\n\t\t\tif (!plot.getOptions().canvas) {\n\t\t\t\treturn addText.call(this, layer, x, y, text, font, angle, width, halign, valign);\n\t\t\t}\n\n\t\t\tvar info = this.getTextInfo(layer, text, font, angle, width),\n\t\t\t\tpositions = info.positions,\n\t\t\t\tlines = info.lines;\n\n\t\t\t// Text is drawn with baseline 'middle', which we need to account\n\t\t\t// for by adding half a line's height to the y position.\n\n\t\t\ty += info.height / lines.length / 2;\n\n\t\t\t// Tweak the initial y-position to match vertical alignment\n\n\t\t\tif (valign == \"middle\") {\n\t\t\t\ty = Math.round(y - info.height / 2);\n\t\t\t} else if (valign == \"bottom\") {\n\t\t\t\ty = Math.round(y - info.height);\n\t\t\t} else {\n\t\t\t\ty = Math.round(y);\n\t\t\t}\n\n\t\t\t// FIXME: LEGACY BROWSER FIX\n\t\t\t// AFFECTS: Opera < 12.00\n\n\t\t\t// Offset the y coordinate, since Opera is off pretty\n\t\t\t// consistently compared to the other browsers.\n\n\t\t\tif (!!(window.opera && window.opera.version().split(\".\")[0] < 12)) {\n\t\t\t\ty -= 2;\n\t\t\t}\n\n\t\t\t// Determine whether this text already exists at this position.\n\t\t\t// If so, mark it for inclusion in the next render pass.\n\n\t\t\tfor (var i = 0, position; position = positions[i]; i++) {\n\t\t\t\tif (position.x == x && position.y == y) {\n\t\t\t\t\tposition.active = true;\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// If the text doesn't exist at this position, create a new entry\n\n\t\t\tposition = {\n\t\t\t\tactive: true,\n\t\t\t\tlines: [],\n\t\t\t\tx: x,\n\t\t\t\ty: y\n\t\t\t};\n\n\t\t\tpositions.push(position);\n\n\t\t\t// Fill in the x & y positions of each line, adjusting them\n\t\t\t// individually for horizontal alignment.\n\n\t\t\tfor (var i = 0, line; line = lines[i]; i++) {\n\t\t\t\tif (halign == \"center\") {\n\t\t\t\t\tposition.lines.push([Math.round(x - line.width / 2), y]);\n\t\t\t\t} else if (halign == \"right\") {\n\t\t\t\t\tposition.lines.push([Math.round(x - line.width), y]);\n\t\t\t\t} else {\n\t\t\t\t\tposition.lines.push([Math.round(x), y]);\n\t\t\t\t}\n\t\t\t\ty += line.height;\n\t\t\t}\n\t\t};\n\t}\n\n\t$.plot.plugins.push({\n\t\tinit: init,\n\t\toptions: options,\n\t\tname: \"canvas\",\n\t\tversion: \"1.0\"\n\t});\n\n})(jQuery);\n"]}