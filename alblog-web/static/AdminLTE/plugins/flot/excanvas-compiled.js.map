{"version":3,"sources":["excanvas.js"],"names":[],"mappings":"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","file":"excanvas-compiled.js","sourcesContent":["// Copyright 2006 Google Inc.\n//\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n//   http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n\n\n// Known Issues:\n//\n// * Patterns only support repeat.\n// * Radial gradient are not implemented. The VML version of these look very\n//   different from the canvas one.\n// * Clipping paths are not implemented.\n// * Coordsize. The width and height attribute have higher priority than the\n//   width and height style values which isn't correct.\n// * Painting mode isn't implemented.\n// * Canvas width/height should is using content-box by default. IE in\n//   Quirks mode will draw the canvas using border-box. Either change your\n//   doctype to HTML5\n//   (http://www.whatwg.org/specs/web-apps/current-work/#the-doctype)\n//   or use Box Sizing Behavior from WebFX\n//   (http://webfx.eae.net/dhtml/boxsizing/boxsizing.html)\n// * Non uniform scaling does not correctly scale strokes.\n// * Filling very large shapes (above 5000 points) is buggy.\n// * Optimize. There is always room for speed improvements.\n\n// Only add this code if we do not already have a canvas implementation\nif (!document.createElement('canvas').getContext) {\n\n(function() {\n\n  // alias some functions to make (compiled) code shorter\n  var m = Math;\n  var mr = m.round;\n  var ms = m.sin;\n  var mc = m.cos;\n  var abs = m.abs;\n  var sqrt = m.sqrt;\n\n  // this is used for sub pixel precision\n  var Z = 10;\n  var Z2 = Z / 2;\n\n  var IE_VERSION = +navigator.userAgent.match(/MSIE ([\\d.]+)?/)[1];\n\n  /**\n   * This funtion is assigned to the <canvas> elements as element.getContext().\n   * @this {HTMLElement}\n   * @return {CanvasRenderingContext2D_}\n   */\n  function getContext() {\n    return this.context_ ||\n        (this.context_ = new CanvasRenderingContext2D_(this));\n  }\n\n  var slice = Array.prototype.slice;\n\n  /**\n   * Binds a function to an object. The returned function will always use the\n   * passed in {@code obj} as {@code this}.\n   *\n   * Example:\n   *\n   *   g = bind(f, obj, a, b)\n   *   g(c, d) // will do f.call(obj, a, b, c, d)\n   *\n   * @param {Function} f The function to bind the object to\n   * @param {Object} obj The object that should act as this when the function\n   *     is called\n   * @param {*} var_args Rest arguments that will be used as the initial\n   *     arguments when the function is called\n   * @return {Function} A new function that has bound this\n   */\n  function bind(f, obj, var_args) {\n    var a = slice.call(arguments, 2);\n    return function() {\n      return f.apply(obj, a.concat(slice.call(arguments)));\n    };\n  }\n\n  function encodeHtmlAttribute(s) {\n    return String(s).replace(/&/g, '&amp;').replace(/\"/g, '&quot;');\n  }\n\n  function addNamespace(doc, prefix, urn) {\n    if (!doc.namespaces[prefix]) {\n      doc.namespaces.add(prefix, urn, '#default#VML');\n    }\n  }\n\n  function addNamespacesAndStylesheet(doc) {\n    addNamespace(doc, 'g_vml_', 'urn:schemas-microsoft-com:vml');\n    addNamespace(doc, 'g_o_', 'urn:schemas-microsoft-com:office:office');\n\n    // Setup default CSS.  Only add one style sheet per document\n    if (!doc.styleSheets['ex_canvas_']) {\n      var ss = doc.createStyleSheet();\n      ss.owningElement.id = 'ex_canvas_';\n      ss.cssText = 'canvas{display:inline-block;overflow:hidden;' +\n          // default size is 300x150 in Gecko and Opera\n          'text-align:left;width:300px;height:150px}';\n    }\n  }\n\n  // Add namespaces and stylesheet at startup.\n  addNamespacesAndStylesheet(document);\n\n  var G_vmlCanvasManager_ = {\n    init: function(opt_doc) {\n      var doc = opt_doc || document;\n      // Create a dummy element so that IE will allow canvas elements to be\n      // recognized.\n      doc.createElement('canvas');\n      doc.attachEvent('onreadystatechange', bind(this.init_, this, doc));\n    },\n\n    init_: function(doc) {\n      // find all canvas elements\n      var els = doc.getElementsByTagName('canvas');\n      for (var i = 0; i < els.length; i++) {\n        this.initElement(els[i]);\n      }\n    },\n\n    /**\n     * Public initializes a canvas element so that it can be used as canvas\n     * element from now on. This is called automatically before the page is\n     * loaded but if you are creating elements using createElement you need to\n     * make sure this is called on the element.\n     * @param {HTMLElement} el The canvas element to initialize.\n     * @return {HTMLElement} the element that was created.\n     */\n    initElement: function(el) {\n      if (!el.getContext) {\n        el.getContext = getContext;\n\n        // Add namespaces and stylesheet to document of the element.\n        addNamespacesAndStylesheet(el.ownerDocument);\n\n        // Remove fallback content. There is no way to hide text nodes so we\n        // just remove all childNodes. We could hide all elements and remove\n        // text nodes but who really cares about the fallback content.\n        el.innerHTML = '';\n\n        // do not use inline function because that will leak memory\n        el.attachEvent('onpropertychange', onPropertyChange);\n        el.attachEvent('onresize', onResize);\n\n        var attrs = el.attributes;\n        if (attrs.width && attrs.width.specified) {\n          // TODO: use runtimeStyle and coordsize\n          // el.getContext().setWidth_(attrs.width.nodeValue);\n          el.style.width = attrs.width.nodeValue + 'px';\n        } else {\n          el.width = el.clientWidth;\n        }\n        if (attrs.height && attrs.height.specified) {\n          // TODO: use runtimeStyle and coordsize\n          // el.getContext().setHeight_(attrs.height.nodeValue);\n          el.style.height = attrs.height.nodeValue + 'px';\n        } else {\n          el.height = el.clientHeight;\n        }\n        //el.getContext().setCoordsize_()\n      }\n      return el;\n    }\n  };\n\n  function onPropertyChange(e) {\n    var el = e.srcElement;\n\n    switch (e.propertyName) {\n      case 'width':\n        el.getContext().clearRect();\n        el.style.width = el.attributes.width.nodeValue + 'px';\n        // In IE8 this does not trigger onresize.\n        el.firstChild.style.width =  el.clientWidth + 'px';\n        break;\n      case 'height':\n        el.getContext().clearRect();\n        el.style.height = el.attributes.height.nodeValue + 'px';\n        el.firstChild.style.height = el.clientHeight + 'px';\n        break;\n    }\n  }\n\n  function onResize(e) {\n    var el = e.srcElement;\n    if (el.firstChild) {\n      el.firstChild.style.width =  el.clientWidth + 'px';\n      el.firstChild.style.height = el.clientHeight + 'px';\n    }\n  }\n\n  G_vmlCanvasManager_.init();\n\n  // precompute \"00\" to \"FF\"\n  var decToHex = [];\n  for (var i = 0; i < 16; i++) {\n    for (var j = 0; j < 16; j++) {\n      decToHex[i * 16 + j] = i.toString(16) + j.toString(16);\n    }\n  }\n\n  function createMatrixIdentity() {\n    return [\n      [1, 0, 0],\n      [0, 1, 0],\n      [0, 0, 1]\n    ];\n  }\n\n  function matrixMultiply(m1, m2) {\n    var result = createMatrixIdentity();\n\n    for (var x = 0; x < 3; x++) {\n      for (var y = 0; y < 3; y++) {\n        var sum = 0;\n\n        for (var z = 0; z < 3; z++) {\n          sum += m1[x][z] * m2[z][y];\n        }\n\n        result[x][y] = sum;\n      }\n    }\n    return result;\n  }\n\n  function copyState(o1, o2) {\n    o2.fillStyle     = o1.fillStyle;\n    o2.lineCap       = o1.lineCap;\n    o2.lineJoin      = o1.lineJoin;\n    o2.lineWidth     = o1.lineWidth;\n    o2.miterLimit    = o1.miterLimit;\n    o2.shadowBlur    = o1.shadowBlur;\n    o2.shadowColor   = o1.shadowColor;\n    o2.shadowOffsetX = o1.shadowOffsetX;\n    o2.shadowOffsetY = o1.shadowOffsetY;\n    o2.strokeStyle   = o1.strokeStyle;\n    o2.globalAlpha   = o1.globalAlpha;\n    o2.font          = o1.font;\n    o2.textAlign     = o1.textAlign;\n    o2.textBaseline  = o1.textBaseline;\n    o2.arcScaleX_    = o1.arcScaleX_;\n    o2.arcScaleY_    = o1.arcScaleY_;\n    o2.lineScale_    = o1.lineScale_;\n  }\n\n  var colorData = {\n    aliceblue: '#F0F8FF',\n    antiquewhite: '#FAEBD7',\n    aquamarine: '#7FFFD4',\n    azure: '#F0FFFF',\n    beige: '#F5F5DC',\n    bisque: '#FFE4C4',\n    black: '#000000',\n    blanchedalmond: '#FFEBCD',\n    blueviolet: '#8A2BE2',\n    brown: '#A52A2A',\n    burlywood: '#DEB887',\n    cadetblue: '#5F9EA0',\n    chartreuse: '#7FFF00',\n    chocolate: '#D2691E',\n    coral: '#FF7F50',\n    cornflowerblue: '#6495ED',\n    cornsilk: '#FFF8DC',\n    crimson: '#DC143C',\n    cyan: '#00FFFF',\n    darkblue: '#00008B',\n    darkcyan: '#008B8B',\n    darkgoldenrod: '#B8860B',\n    darkgray: '#A9A9A9',\n    darkgreen: '#006400',\n    darkgrey: '#A9A9A9',\n    darkkhaki: '#BDB76B',\n    darkmagenta: '#8B008B',\n    darkolivegreen: '#556B2F',\n    darkorange: '#FF8C00',\n    darkorchid: '#9932CC',\n    darkred: '#8B0000',\n    darksalmon: '#E9967A',\n    darkseagreen: '#8FBC8F',\n    darkslateblue: '#483D8B',\n    darkslategray: '#2F4F4F',\n    darkslategrey: '#2F4F4F',\n    darkturquoise: '#00CED1',\n    darkviolet: '#9400D3',\n    deeppink: '#FF1493',\n    deepskyblue: '#00BFFF',\n    dimgray: '#696969',\n    dimgrey: '#696969',\n    dodgerblue: '#1E90FF',\n    firebrick: '#B22222',\n    floralwhite: '#FFFAF0',\n    forestgreen: '#228B22',\n    gainsboro: '#DCDCDC',\n    ghostwhite: '#F8F8FF',\n    gold: '#FFD700',\n    goldenrod: '#DAA520',\n    grey: '#808080',\n    greenyellow: '#ADFF2F',\n    honeydew: '#F0FFF0',\n    hotpink: '#FF69B4',\n    indianred: '#CD5C5C',\n    indigo: '#4B0082',\n    ivory: '#FFFFF0',\n    khaki: '#F0E68C',\n    lavender: '#E6E6FA',\n    lavenderblush: '#FFF0F5',\n    lawngreen: '#7CFC00',\n    lemonchiffon: '#FFFACD',\n    lightblue: '#ADD8E6',\n    lightcoral: '#F08080',\n    lightcyan: '#E0FFFF',\n    lightgoldenrodyellow: '#FAFAD2',\n    lightgreen: '#90EE90',\n    lightgrey: '#D3D3D3',\n    lightpink: '#FFB6C1',\n    lightsalmon: '#FFA07A',\n    lightseagreen: '#20B2AA',\n    lightskyblue: '#87CEFA',\n    lightslategray: '#778899',\n    lightslategrey: '#778899',\n    lightsteelblue: '#B0C4DE',\n    lightyellow: '#FFFFE0',\n    limegreen: '#32CD32',\n    linen: '#FAF0E6',\n    magenta: '#FF00FF',\n    mediumaquamarine: '#66CDAA',\n    mediumblue: '#0000CD',\n    mediumorchid: '#BA55D3',\n    mediumpurple: '#9370DB',\n    mediumseagreen: '#3CB371',\n    mediumslateblue: '#7B68EE',\n    mediumspringgreen: '#00FA9A',\n    mediumturquoise: '#48D1CC',\n    mediumvioletred: '#C71585',\n    midnightblue: '#191970',\n    mintcream: '#F5FFFA',\n    mistyrose: '#FFE4E1',\n    moccasin: '#FFE4B5',\n    navajowhite: '#FFDEAD',\n    oldlace: '#FDF5E6',\n    olivedrab: '#6B8E23',\n    orange: '#FFA500',\n    orangered: '#FF4500',\n    orchid: '#DA70D6',\n    palegoldenrod: '#EEE8AA',\n    palegreen: '#98FB98',\n    paleturquoise: '#AFEEEE',\n    palevioletred: '#DB7093',\n    papayawhip: '#FFEFD5',\n    peachpuff: '#FFDAB9',\n    peru: '#CD853F',\n    pink: '#FFC0CB',\n    plum: '#DDA0DD',\n    powderblue: '#B0E0E6',\n    rosybrown: '#BC8F8F',\n    royalblue: '#4169E1',\n    saddlebrown: '#8B4513',\n    salmon: '#FA8072',\n    sandybrown: '#F4A460',\n    seagreen: '#2E8B57',\n    seashell: '#FFF5EE',\n    sienna: '#A0522D',\n    skyblue: '#87CEEB',\n    slateblue: '#6A5ACD',\n    slategray: '#708090',\n    slategrey: '#708090',\n    snow: '#FFFAFA',\n    springgreen: '#00FF7F',\n    steelblue: '#4682B4',\n    tan: '#D2B48C',\n    thistle: '#D8BFD8',\n    tomato: '#FF6347',\n    turquoise: '#40E0D0',\n    violet: '#EE82EE',\n    wheat: '#F5DEB3',\n    whitesmoke: '#F5F5F5',\n    yellowgreen: '#9ACD32'\n  };\n\n\n  function getRgbHslContent(styleString) {\n    var start = styleString.indexOf('(', 3);\n    var end = styleString.indexOf(')', start + 1);\n    var parts = styleString.substring(start + 1, end).split(',');\n    // add alpha if needed\n    if (parts.length != 4 || styleString.charAt(3) != 'a') {\n      parts[3] = 1;\n    }\n    return parts;\n  }\n\n  function percent(s) {\n    return parseFloat(s) / 100;\n  }\n\n  function clamp(v, min, max) {\n    return Math.min(max, Math.max(min, v));\n  }\n\n  function hslToRgb(parts){\n    var r, g, b, h, s, l;\n    h = parseFloat(parts[0]) / 360 % 360;\n    if (h < 0)\n      h++;\n    s = clamp(percent(parts[1]), 0, 1);\n    l = clamp(percent(parts[2]), 0, 1);\n    if (s == 0) {\n      r = g = b = l; // achromatic\n    } else {\n      var q = l < 0.5 ? l * (1 + s) : l + s - l * s;\n      var p = 2 * l - q;\n      r = hueToRgb(p, q, h + 1 / 3);\n      g = hueToRgb(p, q, h);\n      b = hueToRgb(p, q, h - 1 / 3);\n    }\n\n    return '#' + decToHex[Math.floor(r * 255)] +\n        decToHex[Math.floor(g * 255)] +\n        decToHex[Math.floor(b * 255)];\n  }\n\n  function hueToRgb(m1, m2, h) {\n    if (h < 0)\n      h++;\n    if (h > 1)\n      h--;\n\n    if (6 * h < 1)\n      return m1 + (m2 - m1) * 6 * h;\n    else if (2 * h < 1)\n      return m2;\n    else if (3 * h < 2)\n      return m1 + (m2 - m1) * (2 / 3 - h) * 6;\n    else\n      return m1;\n  }\n\n  var processStyleCache = {};\n\n  function processStyle(styleString) {\n    if (styleString in processStyleCache) {\n      return processStyleCache[styleString];\n    }\n\n    var str, alpha = 1;\n\n    styleString = String(styleString);\n    if (styleString.charAt(0) == '#') {\n      str = styleString;\n    } else if (/^rgb/.test(styleString)) {\n      var parts = getRgbHslContent(styleString);\n      var str = '#', n;\n      for (var i = 0; i < 3; i++) {\n        if (parts[i].indexOf('%') != -1) {\n          n = Math.floor(percent(parts[i]) * 255);\n        } else {\n          n = +parts[i];\n        }\n        str += decToHex[clamp(n, 0, 255)];\n      }\n      alpha = +parts[3];\n    } else if (/^hsl/.test(styleString)) {\n      var parts = getRgbHslContent(styleString);\n      str = hslToRgb(parts);\n      alpha = parts[3];\n    } else {\n      str = colorData[styleString] || styleString;\n    }\n    return processStyleCache[styleString] = {color: str, alpha: alpha};\n  }\n\n  var DEFAULT_STYLE = {\n    style: 'normal',\n    variant: 'normal',\n    weight: 'normal',\n    size: 10,\n    family: 'sans-serif'\n  };\n\n  // Internal text style cache\n  var fontStyleCache = {};\n\n  function processFontStyle(styleString) {\n    if (fontStyleCache[styleString]) {\n      return fontStyleCache[styleString];\n    }\n\n    var el = document.createElement('div');\n    var style = el.style;\n    try {\n      style.font = styleString;\n    } catch (ex) {\n      // Ignore failures to set to invalid font.\n    }\n\n    return fontStyleCache[styleString] = {\n      style: style.fontStyle || DEFAULT_STYLE.style,\n      variant: style.fontVariant || DEFAULT_STYLE.variant,\n      weight: style.fontWeight || DEFAULT_STYLE.weight,\n      size: style.fontSize || DEFAULT_STYLE.size,\n      family: style.fontFamily || DEFAULT_STYLE.family\n    };\n  }\n\n  function getComputedStyle(style, element) {\n    var computedStyle = {};\n\n    for (var p in style) {\n      computedStyle[p] = style[p];\n    }\n\n    // Compute the size\n    var canvasFontSize = parseFloat(element.currentStyle.fontSize),\n        fontSize = parseFloat(style.size);\n\n    if (typeof style.size == 'number') {\n      computedStyle.size = style.size;\n    } else if (style.size.indexOf('px') != -1) {\n      computedStyle.size = fontSize;\n    } else if (style.size.indexOf('em') != -1) {\n      computedStyle.size = canvasFontSize * fontSize;\n    } else if(style.size.indexOf('%') != -1) {\n      computedStyle.size = (canvasFontSize / 100) * fontSize;\n    } else if (style.size.indexOf('pt') != -1) {\n      computedStyle.size = fontSize / .75;\n    } else {\n      computedStyle.size = canvasFontSize;\n    }\n\n    // Different scaling between normal text and VML text. This was found using\n    // trial and error to get the same size as non VML text.\n    computedStyle.size *= 0.981;\n\n    return computedStyle;\n  }\n\n  function buildStyle(style) {\n    return style.style + ' ' + style.variant + ' ' + style.weight + ' ' +\n        style.size + 'px ' + style.family;\n  }\n\n  var lineCapMap = {\n    'butt': 'flat',\n    'round': 'round'\n  };\n\n  function processLineCap(lineCap) {\n    return lineCapMap[lineCap] || 'square';\n  }\n\n  /**\n   * This class implements CanvasRenderingContext2D interface as described by\n   * the WHATWG.\n   * @param {HTMLElement} canvasElement The element that the 2D context should\n   * be associated with\n   */\n  function CanvasRenderingContext2D_(canvasElement) {\n    this.m_ = createMatrixIdentity();\n\n    this.mStack_ = [];\n    this.aStack_ = [];\n    this.currentPath_ = [];\n\n    // Canvas context properties\n    this.strokeStyle = '#000';\n    this.fillStyle = '#000';\n\n    this.lineWidth = 1;\n    this.lineJoin = 'miter';\n    this.lineCap = 'butt';\n    this.miterLimit = Z * 1;\n    this.globalAlpha = 1;\n    this.font = '10px sans-serif';\n    this.textAlign = 'left';\n    this.textBaseline = 'alphabetic';\n    this.canvas = canvasElement;\n\n    var cssText = 'width:' + canvasElement.clientWidth + 'px;height:' +\n        canvasElement.clientHeight + 'px;overflow:hidden;position:absolute';\n    var el = canvasElement.ownerDocument.createElement('div');\n    el.style.cssText = cssText;\n    canvasElement.appendChild(el);\n\n    var overlayEl = el.cloneNode(false);\n    // Use a non transparent background.\n    overlayEl.style.backgroundColor = 'red';\n    overlayEl.style.filter = 'alpha(opacity=0)';\n    canvasElement.appendChild(overlayEl);\n\n    this.element_ = el;\n    this.arcScaleX_ = 1;\n    this.arcScaleY_ = 1;\n    this.lineScale_ = 1;\n  }\n\n  var contextPrototype = CanvasRenderingContext2D_.prototype;\n  contextPrototype.clearRect = function() {\n    if (this.textMeasureEl_) {\n      this.textMeasureEl_.removeNode(true);\n      this.textMeasureEl_ = null;\n    }\n    this.element_.innerHTML = '';\n  };\n\n  contextPrototype.beginPath = function() {\n    // TODO: Branch current matrix so that save/restore has no effect\n    //       as per safari docs.\n    this.currentPath_ = [];\n  };\n\n  contextPrototype.moveTo = function(aX, aY) {\n    var p = getCoords(this, aX, aY);\n    this.currentPath_.push({type: 'moveTo', x: p.x, y: p.y});\n    this.currentX_ = p.x;\n    this.currentY_ = p.y;\n  };\n\n  contextPrototype.lineTo = function(aX, aY) {\n    var p = getCoords(this, aX, aY);\n    this.currentPath_.push({type: 'lineTo', x: p.x, y: p.y});\n\n    this.currentX_ = p.x;\n    this.currentY_ = p.y;\n  };\n\n  contextPrototype.bezierCurveTo = function(aCP1x, aCP1y,\n                                            aCP2x, aCP2y,\n                                            aX, aY) {\n    var p = getCoords(this, aX, aY);\n    var cp1 = getCoords(this, aCP1x, aCP1y);\n    var cp2 = getCoords(this, aCP2x, aCP2y);\n    bezierCurveTo(this, cp1, cp2, p);\n  };\n\n  // Helper function that takes the already fixed cordinates.\n  function bezierCurveTo(self, cp1, cp2, p) {\n    self.currentPath_.push({\n      type: 'bezierCurveTo',\n      cp1x: cp1.x,\n      cp1y: cp1.y,\n      cp2x: cp2.x,\n      cp2y: cp2.y,\n      x: p.x,\n      y: p.y\n    });\n    self.currentX_ = p.x;\n    self.currentY_ = p.y;\n  }\n\n  contextPrototype.quadraticCurveTo = function(aCPx, aCPy, aX, aY) {\n    // the following is lifted almost directly from\n    // http://developer.mozilla.org/en/docs/Canvas_tutorial:Drawing_shapes\n\n    var cp = getCoords(this, aCPx, aCPy);\n    var p = getCoords(this, aX, aY);\n\n    var cp1 = {\n      x: this.currentX_ + 2.0 / 3.0 * (cp.x - this.currentX_),\n      y: this.currentY_ + 2.0 / 3.0 * (cp.y - this.currentY_)\n    };\n    var cp2 = {\n      x: cp1.x + (p.x - this.currentX_) / 3.0,\n      y: cp1.y + (p.y - this.currentY_) / 3.0\n    };\n\n    bezierCurveTo(this, cp1, cp2, p);\n  };\n\n  contextPrototype.arc = function(aX, aY, aRadius,\n                                  aStartAngle, aEndAngle, aClockwise) {\n    aRadius *= Z;\n    var arcType = aClockwise ? 'at' : 'wa';\n\n    var xStart = aX + mc(aStartAngle) * aRadius - Z2;\n    var yStart = aY + ms(aStartAngle) * aRadius - Z2;\n\n    var xEnd = aX + mc(aEndAngle) * aRadius - Z2;\n    var yEnd = aY + ms(aEndAngle) * aRadius - Z2;\n\n    // IE won't render arches drawn counter clockwise if xStart == xEnd.\n    if (xStart == xEnd && !aClockwise) {\n      xStart += 0.125; // Offset xStart by 1/80 of a pixel. Use something\n                       // that can be represented in binary\n    }\n\n    var p = getCoords(this, aX, aY);\n    var pStart = getCoords(this, xStart, yStart);\n    var pEnd = getCoords(this, xEnd, yEnd);\n\n    this.currentPath_.push({type: arcType,\n                           x: p.x,\n                           y: p.y,\n                           radius: aRadius,\n                           xStart: pStart.x,\n                           yStart: pStart.y,\n                           xEnd: pEnd.x,\n                           yEnd: pEnd.y});\n\n  };\n\n  contextPrototype.rect = function(aX, aY, aWidth, aHeight) {\n    this.moveTo(aX, aY);\n    this.lineTo(aX + aWidth, aY);\n    this.lineTo(aX + aWidth, aY + aHeight);\n    this.lineTo(aX, aY + aHeight);\n    this.closePath();\n  };\n\n  contextPrototype.strokeRect = function(aX, aY, aWidth, aHeight) {\n    var oldPath = this.currentPath_;\n    this.beginPath();\n\n    this.moveTo(aX, aY);\n    this.lineTo(aX + aWidth, aY);\n    this.lineTo(aX + aWidth, aY + aHeight);\n    this.lineTo(aX, aY + aHeight);\n    this.closePath();\n    this.stroke();\n\n    this.currentPath_ = oldPath;\n  };\n\n  contextPrototype.fillRect = function(aX, aY, aWidth, aHeight) {\n    var oldPath = this.currentPath_;\n    this.beginPath();\n\n    this.moveTo(aX, aY);\n    this.lineTo(aX + aWidth, aY);\n    this.lineTo(aX + aWidth, aY + aHeight);\n    this.lineTo(aX, aY + aHeight);\n    this.closePath();\n    this.fill();\n\n    this.currentPath_ = oldPath;\n  };\n\n  contextPrototype.createLinearGradient = function(aX0, aY0, aX1, aY1) {\n    var gradient = new CanvasGradient_('gradient');\n    gradient.x0_ = aX0;\n    gradient.y0_ = aY0;\n    gradient.x1_ = aX1;\n    gradient.y1_ = aY1;\n    return gradient;\n  };\n\n  contextPrototype.createRadialGradient = function(aX0, aY0, aR0,\n                                                   aX1, aY1, aR1) {\n    var gradient = new CanvasGradient_('gradientradial');\n    gradient.x0_ = aX0;\n    gradient.y0_ = aY0;\n    gradient.r0_ = aR0;\n    gradient.x1_ = aX1;\n    gradient.y1_ = aY1;\n    gradient.r1_ = aR1;\n    return gradient;\n  };\n\n  contextPrototype.drawImage = function(image, var_args) {\n    var dx, dy, dw, dh, sx, sy, sw, sh;\n\n    // to find the original width we overide the width and height\n    var oldRuntimeWidth = image.runtimeStyle.width;\n    var oldRuntimeHeight = image.runtimeStyle.height;\n    image.runtimeStyle.width = 'auto';\n    image.runtimeStyle.height = 'auto';\n\n    // get the original size\n    var w = image.width;\n    var h = image.height;\n\n    // and remove overides\n    image.runtimeStyle.width = oldRuntimeWidth;\n    image.runtimeStyle.height = oldRuntimeHeight;\n\n    if (arguments.length == 3) {\n      dx = arguments[1];\n      dy = arguments[2];\n      sx = sy = 0;\n      sw = dw = w;\n      sh = dh = h;\n    } else if (arguments.length == 5) {\n      dx = arguments[1];\n      dy = arguments[2];\n      dw = arguments[3];\n      dh = arguments[4];\n      sx = sy = 0;\n      sw = w;\n      sh = h;\n    } else if (arguments.length == 9) {\n      sx = arguments[1];\n      sy = arguments[2];\n      sw = arguments[3];\n      sh = arguments[4];\n      dx = arguments[5];\n      dy = arguments[6];\n      dw = arguments[7];\n      dh = arguments[8];\n    } else {\n      throw Error('Invalid number of arguments');\n    }\n\n    var d = getCoords(this, dx, dy);\n\n    var w2 = sw / 2;\n    var h2 = sh / 2;\n\n    var vmlStr = [];\n\n    var W = 10;\n    var H = 10;\n\n    // For some reason that I've now forgotten, using divs didn't work\n    vmlStr.push(' <g_vml_:group',\n                ' coordsize=\"', Z * W, ',', Z * H, '\"',\n                ' coordorigin=\"0,0\"' ,\n                ' style=\"width:', W, 'px;height:', H, 'px;position:absolute;');\n\n    // If filters are necessary (rotation exists), create them\n    // filters are bog-slow, so only create them if abbsolutely necessary\n    // The following check doesn't account for skews (which don't exist\n    // in the canvas spec (yet) anyway.\n\n    if (this.m_[0][0] != 1 || this.m_[0][1] ||\n        this.m_[1][1] != 1 || this.m_[1][0]) {\n      var filter = [];\n\n      // Note the 12/21 reversal\n      filter.push('M11=', this.m_[0][0], ',',\n                  'M12=', this.m_[1][0], ',',\n                  'M21=', this.m_[0][1], ',',\n                  'M22=', this.m_[1][1], ',',\n                  'Dx=', mr(d.x / Z), ',',\n                  'Dy=', mr(d.y / Z), '');\n\n      // Bounding box calculation (need to minimize displayed area so that\n      // filters don't waste time on unused pixels.\n      var max = d;\n      var c2 = getCoords(this, dx + dw, dy);\n      var c3 = getCoords(this, dx, dy + dh);\n      var c4 = getCoords(this, dx + dw, dy + dh);\n\n      max.x = m.max(max.x, c2.x, c3.x, c4.x);\n      max.y = m.max(max.y, c2.y, c3.y, c4.y);\n\n      vmlStr.push('padding:0 ', mr(max.x / Z), 'px ', mr(max.y / Z),\n                  'px 0;filter:progid:DXImageTransform.Microsoft.Matrix(',\n                  filter.join(''), \", sizingmethod='clip');\");\n\n    } else {\n      vmlStr.push('top:', mr(d.y / Z), 'px;left:', mr(d.x / Z), 'px;');\n    }\n\n    vmlStr.push(' \">' ,\n                '<g_vml_:image src=\"', image.src, '\"',\n                ' style=\"width:', Z * dw, 'px;',\n                ' height:', Z * dh, 'px\"',\n                ' cropleft=\"', sx / w, '\"',\n                ' croptop=\"', sy / h, '\"',\n                ' cropright=\"', (w - sx - sw) / w, '\"',\n                ' cropbottom=\"', (h - sy - sh) / h, '\"',\n                ' />',\n                '</g_vml_:group>');\n\n    this.element_.insertAdjacentHTML('BeforeEnd', vmlStr.join(''));\n  };\n\n  contextPrototype.stroke = function(aFill) {\n    var W = 10;\n    var H = 10;\n    // Divide the shape into chunks if it's too long because IE has a limit\n    // somewhere for how long a VML shape can be. This simple division does\n    // not work with fills, only strokes, unfortunately.\n    var chunkSize = 5000;\n\n    var min = {x: null, y: null};\n    var max = {x: null, y: null};\n\n    for (var j = 0; j < this.currentPath_.length; j += chunkSize) {\n      var lineStr = [];\n      var lineOpen = false;\n\n      lineStr.push('<g_vml_:shape',\n                   ' filled=\"', !!aFill, '\"',\n                   ' style=\"position:absolute;width:', W, 'px;height:', H, 'px;\"',\n                   ' coordorigin=\"0,0\"',\n                   ' coordsize=\"', Z * W, ',', Z * H, '\"',\n                   ' stroked=\"', !aFill, '\"',\n                   ' path=\"');\n\n      var newSeq = false;\n\n      for (var i = j; i < Math.min(j + chunkSize, this.currentPath_.length); i++) {\n        if (i % chunkSize == 0 && i > 0) { // move into position for next chunk\n          lineStr.push(' m ', mr(this.currentPath_[i-1].x), ',', mr(this.currentPath_[i-1].y));\n        }\n\n        var p = this.currentPath_[i];\n        var c;\n\n        switch (p.type) {\n          case 'moveTo':\n            c = p;\n            lineStr.push(' m ', mr(p.x), ',', mr(p.y));\n            break;\n          case 'lineTo':\n            lineStr.push(' l ', mr(p.x), ',', mr(p.y));\n            break;\n          case 'close':\n            lineStr.push(' x ');\n            p = null;\n            break;\n          case 'bezierCurveTo':\n            lineStr.push(' c ',\n                         mr(p.cp1x), ',', mr(p.cp1y), ',',\n                         mr(p.cp2x), ',', mr(p.cp2y), ',',\n                         mr(p.x), ',', mr(p.y));\n            break;\n          case 'at':\n          case 'wa':\n            lineStr.push(' ', p.type, ' ',\n                         mr(p.x - this.arcScaleX_ * p.radius), ',',\n                         mr(p.y - this.arcScaleY_ * p.radius), ' ',\n                         mr(p.x + this.arcScaleX_ * p.radius), ',',\n                         mr(p.y + this.arcScaleY_ * p.radius), ' ',\n                         mr(p.xStart), ',', mr(p.yStart), ' ',\n                         mr(p.xEnd), ',', mr(p.yEnd));\n            break;\n        }\n  \n  \n        // TODO: Following is broken for curves due to\n        //       move to proper paths.\n  \n        // Figure out dimensions so we can do gradient fills\n        // properly\n        if (p) {\n          if (min.x == null || p.x < min.x) {\n            min.x = p.x;\n          }\n          if (max.x == null || p.x > max.x) {\n            max.x = p.x;\n          }\n          if (min.y == null || p.y < min.y) {\n            min.y = p.y;\n          }\n          if (max.y == null || p.y > max.y) {\n            max.y = p.y;\n          }\n        }\n      }\n      lineStr.push(' \">');\n  \n      if (!aFill) {\n        appendStroke(this, lineStr);\n      } else {\n        appendFill(this, lineStr, min, max);\n      }\n  \n      lineStr.push('</g_vml_:shape>');\n  \n      this.element_.insertAdjacentHTML('beforeEnd', lineStr.join(''));\n    }\n  };\n\n  function appendStroke(ctx, lineStr) {\n    var a = processStyle(ctx.strokeStyle);\n    var color = a.color;\n    var opacity = a.alpha * ctx.globalAlpha;\n    var lineWidth = ctx.lineScale_ * ctx.lineWidth;\n\n    // VML cannot correctly render a line if the width is less than 1px.\n    // In that case, we dilute the color to make the line look thinner.\n    if (lineWidth < 1) {\n      opacity *= lineWidth;\n    }\n\n    lineStr.push(\n      '<g_vml_:stroke',\n      ' opacity=\"', opacity, '\"',\n      ' joinstyle=\"', ctx.lineJoin, '\"',\n      ' miterlimit=\"', ctx.miterLimit, '\"',\n      ' endcap=\"', processLineCap(ctx.lineCap), '\"',\n      ' weight=\"', lineWidth, 'px\"',\n      ' color=\"', color, '\" />'\n    );\n  }\n\n  function appendFill(ctx, lineStr, min, max) {\n    var fillStyle = ctx.fillStyle;\n    var arcScaleX = ctx.arcScaleX_;\n    var arcScaleY = ctx.arcScaleY_;\n    var width = max.x - min.x;\n    var height = max.y - min.y;\n    if (fillStyle instanceof CanvasGradient_) {\n      // TODO: Gradients transformed with the transformation matrix.\n      var angle = 0;\n      var focus = {x: 0, y: 0};\n\n      // additional offset\n      var shift = 0;\n      // scale factor for offset\n      var expansion = 1;\n\n      if (fillStyle.type_ == 'gradient') {\n        var x0 = fillStyle.x0_ / arcScaleX;\n        var y0 = fillStyle.y0_ / arcScaleY;\n        var x1 = fillStyle.x1_ / arcScaleX;\n        var y1 = fillStyle.y1_ / arcScaleY;\n        var p0 = getCoords(ctx, x0, y0);\n        var p1 = getCoords(ctx, x1, y1);\n        var dx = p1.x - p0.x;\n        var dy = p1.y - p0.y;\n        angle = Math.atan2(dx, dy) * 180 / Math.PI;\n\n        // The angle should be a non-negative number.\n        if (angle < 0) {\n          angle += 360;\n        }\n\n        // Very small angles produce an unexpected result because they are\n        // converted to a scientific notation string.\n        if (angle < 1e-6) {\n          angle = 0;\n        }\n      } else {\n        var p0 = getCoords(ctx, fillStyle.x0_, fillStyle.y0_);\n        focus = {\n          x: (p0.x - min.x) / width,\n          y: (p0.y - min.y) / height\n        };\n\n        width  /= arcScaleX * Z;\n        height /= arcScaleY * Z;\n        var dimension = m.max(width, height);\n        shift = 2 * fillStyle.r0_ / dimension;\n        expansion = 2 * fillStyle.r1_ / dimension - shift;\n      }\n\n      // We need to sort the color stops in ascending order by offset,\n      // otherwise IE won't interpret it correctly.\n      var stops = fillStyle.colors_;\n      stops.sort(function(cs1, cs2) {\n        return cs1.offset - cs2.offset;\n      });\n\n      var length = stops.length;\n      var color1 = stops[0].color;\n      var color2 = stops[length - 1].color;\n      var opacity1 = stops[0].alpha * ctx.globalAlpha;\n      var opacity2 = stops[length - 1].alpha * ctx.globalAlpha;\n\n      var colors = [];\n      for (var i = 0; i < length; i++) {\n        var stop = stops[i];\n        colors.push(stop.offset * expansion + shift + ' ' + stop.color);\n      }\n\n      // When colors attribute is used, the meanings of opacity and o:opacity2\n      // are reversed.\n      lineStr.push('<g_vml_:fill type=\"', fillStyle.type_, '\"',\n                   ' method=\"none\" focus=\"100%\"',\n                   ' color=\"', color1, '\"',\n                   ' color2=\"', color2, '\"',\n                   ' colors=\"', colors.join(','), '\"',\n                   ' opacity=\"', opacity2, '\"',\n                   ' g_o_:opacity2=\"', opacity1, '\"',\n                   ' angle=\"', angle, '\"',\n                   ' focusposition=\"', focus.x, ',', focus.y, '\" />');\n    } else if (fillStyle instanceof CanvasPattern_) {\n      if (width && height) {\n        var deltaLeft = -min.x;\n        var deltaTop = -min.y;\n        lineStr.push('<g_vml_:fill',\n                     ' position=\"',\n                     deltaLeft / width * arcScaleX * arcScaleX, ',',\n                     deltaTop / height * arcScaleY * arcScaleY, '\"',\n                     ' type=\"tile\"',\n                     // TODO: Figure out the correct size to fit the scale.\n                     //' size=\"', w, 'px ', h, 'px\"',\n                     ' src=\"', fillStyle.src_, '\" />');\n       }\n    } else {\n      var a = processStyle(ctx.fillStyle);\n      var color = a.color;\n      var opacity = a.alpha * ctx.globalAlpha;\n      lineStr.push('<g_vml_:fill color=\"', color, '\" opacity=\"', opacity,\n                   '\" />');\n    }\n  }\n\n  contextPrototype.fill = function() {\n    this.stroke(true);\n  };\n\n  contextPrototype.closePath = function() {\n    this.currentPath_.push({type: 'close'});\n  };\n\n  function getCoords(ctx, aX, aY) {\n    var m = ctx.m_;\n    return {\n      x: Z * (aX * m[0][0] + aY * m[1][0] + m[2][0]) - Z2,\n      y: Z * (aX * m[0][1] + aY * m[1][1] + m[2][1]) - Z2\n    };\n  }\n    contextPrototype.save = function() {\n    var o = {};\n    copyState(this, o);\n    this.aStack_.push(o);\n    this.mStack_.push(this.m_);\n    this.m_ = matrixMultiply(createMatrixIdentity(), this.m_);\n  };\n\n  contextPrototype.restore = function() {\n    if (this.aStack_.length) {\n      copyState(this.aStack_.pop(), this);\n      this.m_ = this.mStack_.pop();\n    }\n  };\n\n  function matrixIsFinite(m) {\n    return isFinite(m[0][0]) && isFinite(m[0][1]) &&\n        isFinite(m[1][0]) && isFinite(m[1][1]) &&\n        isFinite(m[2][0]) && isFinite(m[2][1]);\n  }\n\n  function setM(ctx, m, updateLineScale) {\n    if (!matrixIsFinite(m)) {\n      return;\n    }\n    ctx.m_ = m;\n\n    if (updateLineScale) {\n      // Get the line scale.\n      // Determinant of this.m_ means how much the area is enlarged by the\n      // transformation. So its square root can be used as a scale factor\n      // for width.\n      var det = m[0][0] * m[1][1] - m[0][1] * m[1][0];\n      ctx.lineScale_ = sqrt(abs(det));\n    }\n  }\n\n  contextPrototype.translate = function(aX, aY) {\n    var m1 = [\n      [1,  0,  0],\n      [0,  1,  0],\n      [aX, aY, 1]\n    ];\n\n    setM(this, matrixMultiply(m1, this.m_), false);\n  };\n\n  contextPrototype.rotate = function(aRot) {\n    var c = mc(aRot);\n    var s = ms(aRot);\n\n    var m1 = [\n      [c,  s, 0],\n      [-s, c, 0],\n      [0,  0, 1]\n    ];\n\n    setM(this, matrixMultiply(m1, this.m_), false);\n  };\n\n  contextPrototype.scale = function(aX, aY) {\n    this.arcScaleX_ *= aX;\n    this.arcScaleY_ *= aY;\n    var m1 = [\n      [aX, 0,  0],\n      [0,  aY, 0],\n      [0,  0,  1]\n    ];\n\n    setM(this, matrixMultiply(m1, this.m_), true);\n  };\n\n  contextPrototype.transform = function(m11, m12, m21, m22, dx, dy) {\n    var m1 = [\n      [m11, m12, 0],\n      [m21, m22, 0],\n      [dx,  dy,  1]\n    ];\n\n    setM(this, matrixMultiply(m1, this.m_), true);\n  };\n\n  contextPrototype.setTransform = function(m11, m12, m21, m22, dx, dy) {\n    var m = [\n      [m11, m12, 0],\n      [m21, m22, 0],\n      [dx,  dy,  1]\n    ];\n\n    setM(this, m, true);\n  };\n\n  /**\n   * The text drawing function.\n   * The maxWidth argument isn't taken in account, since no browser supports\n   * it yet.\n   */\n  contextPrototype.drawText_ = function(text, x, y, maxWidth, stroke) {\n    var m = this.m_,\n        delta = 1000,\n        left = 0,\n        right = delta,\n        offset = {x: 0, y: 0},\n        lineStr = [];\n\n    var fontStyle = getComputedStyle(processFontStyle(this.font),\n                                     this.element_);\n\n    var fontStyleString = buildStyle(fontStyle);\n\n    var elementStyle = this.element_.currentStyle;\n    var textAlign = this.textAlign.toLowerCase();\n    switch (textAlign) {\n      case 'left':\n      case 'center':\n      case 'right':\n        break;\n      case 'end':\n        textAlign = elementStyle.direction == 'ltr' ? 'right' : 'left';\n        break;\n      case 'start':\n        textAlign = elementStyle.direction == 'rtl' ? 'right' : 'left';\n        break;\n      default:\n        textAlign = 'left';\n    }\n\n    // 1.75 is an arbitrary number, as there is no info about the text baseline\n    switch (this.textBaseline) {\n      case 'hanging':\n      case 'top':\n        offset.y = fontStyle.size / 1.75;\n        break;\n      case 'middle':\n        break;\n      default:\n      case null:\n      case 'alphabetic':\n      case 'ideographic':\n      case 'bottom':\n        offset.y = -fontStyle.size / 2.25;\n        break;\n    }\n\n    switch(textAlign) {\n      case 'right':\n        left = delta;\n        right = 0.05;\n        break;\n      case 'center':\n        left = right = delta / 2;\n        break;\n    }\n\n    var d = getCoords(this, x + offset.x, y + offset.y);\n\n    lineStr.push('<g_vml_:line from=\"', -left ,' 0\" to=\"', right ,' 0.05\" ',\n                 ' coordsize=\"100 100\" coordorigin=\"0 0\"',\n                 ' filled=\"', !stroke, '\" stroked=\"', !!stroke,\n                 '\" style=\"position:absolute;width:1px;height:1px;\">');\n\n    if (stroke) {\n      appendStroke(this, lineStr);\n    } else {\n      // TODO: Fix the min and max params.\n      appendFill(this, lineStr, {x: -left, y: 0},\n                 {x: right, y: fontStyle.size});\n    }\n\n    var skewM = m[0][0].toFixed(3) + ',' + m[1][0].toFixed(3) + ',' +\n                m[0][1].toFixed(3) + ',' + m[1][1].toFixed(3) + ',0,0';\n\n    var skewOffset = mr(d.x / Z) + ',' + mr(d.y / Z);\n\n    lineStr.push('<g_vml_:skew on=\"t\" matrix=\"', skewM ,'\" ',\n                 ' offset=\"', skewOffset, '\" origin=\"', left ,' 0\" />',\n                 '<g_vml_:path textpathok=\"true\" />',\n                 '<g_vml_:textpath on=\"true\" string=\"',\n                 encodeHtmlAttribute(text),\n                 '\" style=\"v-text-align:', textAlign,\n                 ';font:', encodeHtmlAttribute(fontStyleString),\n                 '\" /></g_vml_:line>');\n\n    this.element_.insertAdjacentHTML('beforeEnd', lineStr.join(''));\n  };\n\n  contextPrototype.fillText = function(text, x, y, maxWidth) {\n    this.drawText_(text, x, y, maxWidth, false);\n  };\n\n  contextPrototype.strokeText = function(text, x, y, maxWidth) {\n    this.drawText_(text, x, y, maxWidth, true);\n  };\n\n  contextPrototype.measureText = function(text) {\n    if (!this.textMeasureEl_) {\n      var s = '<span style=\"position:absolute;' +\n          'top:-20000px;left:0;padding:0;margin:0;border:none;' +\n          'white-space:pre;\"></span>';\n      this.element_.insertAdjacentHTML('beforeEnd', s);\n      this.textMeasureEl_ = this.element_.lastChild;\n    }\n    var doc = this.element_.ownerDocument;\n    this.textMeasureEl_.innerHTML = '';\n    this.textMeasureEl_.style.font = this.font;\n    // Don't use innerHTML or innerText because they allow markup/whitespace.\n    this.textMeasureEl_.appendChild(doc.createTextNode(text));\n    return {width: this.textMeasureEl_.offsetWidth};\n  };\n\n  /******** STUBS ********/\n  contextPrototype.clip = function() {\n    // TODO: Implement\n  };\n\n  contextPrototype.arcTo = function() {\n    // TODO: Implement\n  };\n\n  contextPrototype.createPattern = function(image, repetition) {\n    return new CanvasPattern_(image, repetition);\n  };\n\n  // Gradient / Pattern Stubs\n  function CanvasGradient_(aType) {\n    this.type_ = aType;\n    this.x0_ = 0;\n    this.y0_ = 0;\n    this.r0_ = 0;\n    this.x1_ = 0;\n    this.y1_ = 0;\n    this.r1_ = 0;\n    this.colors_ = [];\n  }\n\n  CanvasGradient_.prototype.addColorStop = function(aOffset, aColor) {\n    aColor = processStyle(aColor);\n    this.colors_.push({offset: aOffset,\n                       color: aColor.color,\n                       alpha: aColor.alpha});\n  };\n\n  function CanvasPattern_(image, repetition) {\n    assertImageIsValid(image);\n    switch (repetition) {\n      case 'repeat':\n      case null:\n      case '':\n        this.repetition_ = 'repeat';\n        break;\n      case 'repeat-x':\n      case 'repeat-y':\n      case 'no-repeat':\n        this.repetition_ = repetition;\n        break;\n      default:\n        throwException('SYNTAX_ERR');\n    }\n\n    this.src_ = image.src;\n    this.width_ = image.width;\n    this.height_ = image.height;\n  }\n\n  function throwException(s) {\n    throw new DOMException_(s);\n  }\n\n  function assertImageIsValid(img) {\n    if (!img || img.nodeType != 1 || img.tagName != 'IMG') {\n      throwException('TYPE_MISMATCH_ERR');\n    }\n    if (img.readyState != 'complete') {\n      throwException('INVALID_STATE_ERR');\n    }\n  }\n\n  function DOMException_(s) {\n    this.code = this[s];\n    this.message = s +': DOM Exception ' + this.code;\n  }\n  var p = DOMException_.prototype = new Error;\n  p.INDEX_SIZE_ERR = 1;\n  p.DOMSTRING_SIZE_ERR = 2;\n  p.HIERARCHY_REQUEST_ERR = 3;\n  p.WRONG_DOCUMENT_ERR = 4;\n  p.INVALID_CHARACTER_ERR = 5;\n  p.NO_DATA_ALLOWED_ERR = 6;\n  p.NO_MODIFICATION_ALLOWED_ERR = 7;\n  p.NOT_FOUND_ERR = 8;\n  p.NOT_SUPPORTED_ERR = 9;\n  p.INUSE_ATTRIBUTE_ERR = 10;\n  p.INVALID_STATE_ERR = 11;\n  p.SYNTAX_ERR = 12;\n  p.INVALID_MODIFICATION_ERR = 13;\n  p.NAMESPACE_ERR = 14;\n  p.INVALID_ACCESS_ERR = 15;\n  p.VALIDATION_ERR = 16;\n  p.TYPE_MISMATCH_ERR = 17;\n\n  // set up externs\n  G_vmlCanvasManager = G_vmlCanvasManager_;\n  CanvasRenderingContext2D = CanvasRenderingContext2D_;\n  CanvasGradient = CanvasGradient_;\n  CanvasPattern = CanvasPattern_;\n  DOMException = DOMException_;\n})();\n\n} // if\n"]}